#!/usr/bin/env bash
echo "Running the dev-app build :"

yum update
yum install -y git g++ gcc libgcc libstdc++ linux-headers make
curl -sL https://rpm.nodesource.com/setup_11.x | sudo -E bash -
#sudo yum install -y nodejs

echo "1 Checking current working dir *********************************************"
pwd
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "2 Checking Node and Npm version ****************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
#node --version
#npm --version
#npm set progress=false && npm config set depth 0 && npm cache clean --force
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"


#rm -rf package-lock.json
echo  "*******************************************"
yum install -y nginx
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo " 3 Check nginx version*******************************************************"
nginx -v
echo "3.1 Adding a sample website"
cd  /usr/share/nginx/html && rm -rf index.html
cd /usr/share/nginx/html && echo "<h1> This is a Sample Website deployment by DevOps Pipeline</h1>" >> index.html

echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "4 Checking current working dir**************************************"
pwd
echo "****************************************************************************"
echo "****************************************************************************"
echo "5 Starting nginx *************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
sudo pkill -f nginx
sudo systemctl start nginx
echo "6 Checking nginx Status *****************************************************"
sudo systemctl status nginx
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
echo "****************************************************************************"
